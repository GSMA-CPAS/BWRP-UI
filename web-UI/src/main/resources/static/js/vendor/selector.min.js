/*
 Copyright (C) James Nates 2017
 Distributed under the MIT License (license terms are at http://opensource.org/licenses/MIT).
 */
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var SelectPure=function(){var e={value:"data-value",disabled:"data-disabled",class:"class",type:"type"},t=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,t),this._node=_instanceof(e,HTMLElement)?e:document.createElement(e),this._config={i18n:i},this._setAttributes(n),n.textContent&&this._setTextContent(n.textContent),this}return _createClass(t,[{key:"get",value:function(){return this._node}},{key:"append",value:function(e){return this._node.appendChild(e),this}},{key:"addClass",value:function(e){return this._node.classList.add(e),this}},{key:"removeClass",value:function(e){return this._node.classList.remove(e),this}},{key:"toggleClass",value:function(e){return this._node.classList.toggle(e),this}},{key:"addEventListener",value:function(e,t){return this._node.addEventListener(e,t),this}},{key:"removeEventListener",value:function(e,t){return this._node.removeEventListener(e,t),this}},{key:"setText",value:function(e){return this._setTextContent(e),this}},{key:"getHeight",value:function(){return window.getComputedStyle(this._node).height}},{key:"setTop",value:function(e){return this._node.style.top="".concat(e,"px"),this}},{key:"focus",value:function(){return this._node.focus(),this}},{key:"_setTextContent",value:function(e){this._node.textContent=e}},{key:"_setAttributes",value:function(t){for(var n in t)e[n]&&t[n]&&this._setAttribute(e[n],t[n])}},{key:"_setAttribute",value:function(e,t){this._node.setAttribute(e,t)}}]),t}(),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};return function(){function e(i,s){_classCallCheck(this,e),this._config=n({},s),this._state={opened:!1},this._icons=[],this._boundHandleClick=this._handleClick.bind(this),this._boundUnselectOption=this._unselectOption.bind(this),this._boundSortOptions=this._sortOptions.bind(this),this._body=new t(document.body),this._create(i),this._setValue()}return _createClass(e,[{key:"_create",value:function(e){var n="string"==typeof e?document.querySelector(e):e;this._parent=new t(n),this._select=new t("div",{class:"select-pure__select"}),this._label=new t("span",{class:"select-pure__label"}),this._optionsWrapper=new t("div",{class:"select-pure__options"}),this._config.multiple&&this._select.addClass("select-pure__select--multiple"),this._options=this._generateOptions(),this._select.addEventListener("click",this._boundHandleClick),this._select.append(this._label.get()),this._select.append(this._optionsWrapper.get()),this._parent.append(this._select.get())}},{key:"_generateOptions",value:function(){var e=this;return this._config.autocomplete&&(this._autocomplete=new t("input",{class:"select-pure__autocomplete",type:"text"}),this._autocomplete.addEventListener("input",this._boundSortOptions),this._optionsWrapper.append(this._autocomplete.get())),this._config.options.map(function(n){var i=new t("div",{class:"select-pure__option",value:n.value,textContent:n.label,disabled:n.disabled});return e._optionsWrapper.append(i.get()),i})}},{key:"_handleClick",value:function(e){if(e.stopPropagation(),"select-pure__autocomplete"!==e.target.className){if(this._state.opened){var t=this._options.find(function(t){return t.get()===e.target});return t&&this._setValue(t.get().getAttribute("data-value"),!0),this._select.removeClass("select-pure__select--opened"),this._body.removeEventListener("click",this._boundHandleClick),this._select.addEventListener("click",this._boundHandleClick),void(this._state.opened=!1)}e.target.className!==this._config.icon&&(this._select.addClass("select-pure__select--opened"),this._body.addEventListener("click",this._boundHandleClick),this._select.removeEventListener("click",this._boundHandleClick),this._state.opened=!0,this._autocomplete&&this._autocomplete.focus())}}},{key:"_setValue",value:function(e,t,n){var i=this;if(e&&!n&&(this._config.value=this._config.multiple?this._config.value.concat(e):e),e&&n&&(this._config.value=e),this._options.forEach(function(e){e.removeClass("select-pure__option--selected")}),this._config.multiple){var s=this._config.value.map(function(e){var t=i._config.options.find(function(t){return t.value===e});return i._options.find(function(e){return e.get().getAttribute("data-value")===t.value.toString()}).addClass("select-pure__option--selected"),t});this._selectOptions(s,t)}else{var o=this._config.value?this._config.options.find(function(e){return e.value.toString()===i._config.value}):this._config.options[0];this._options.find(function(e){return e.get().getAttribute("data-value")===o.value.toString()}).addClass("select-pure__option--selected"),this._selectOption(o,t)}}},{key:"_selectOption",value:function(e,t){this._selectedOption=e,this._label.setText(e.label),this._config.onChange&&t&&this._config.onChange(e.value)}},{key:"_selectOptions",value:function(e,n){var i=this;this._label.setText(""),this._icons=e.map(function(e){var n=new t("span",{class:"select-pure__selected-label",textContent:e.label}),s=new t("i",{class:i._config.icon,value:e.value});return s.addEventListener("click",i._boundUnselectOption),n.append(s.get()),i._label.append(n.get()),s.get()}),n&&this._optionsWrapper.setTop(Number(this._select.getHeight().split("px")[0])+5),this._config.onChange&&n&&this._config.onChange(this._config.value)}},{key:"_unselectOption",value:function(e){var t=_toConsumableArray(this._config.value),n=t.indexOf(e.target.getAttribute("data-value"));-1!==n&&t.splice(n,1),this._setValue(t,!0,!0)}},{key:"_sortOptions",value:function(e){this._options.forEach(function(t){t.get().textContent.toLowerCase().startsWith(e.target.value.toLowerCase())?t.removeClass("select-pure__option--hidden"):t.addClass("select-pure__option--hidden")})}}]),e}()}();